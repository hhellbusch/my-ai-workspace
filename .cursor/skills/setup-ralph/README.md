# setup-ralph

A Claude Code skill that sets up [Ralph Wiggum loops](https://ghuntley.com/ralph/) - Geoffrey Huntley's autonomous AI coding technique.

## What is Ralph?

Ralph is an autonomous coding methodology where Claude runs in a loop:

```bash
while :; do cat PROMPT.md | claude -p --dangerously-skip-permissions; done
```

Each iteration:
1. Reads specs and implementation plan
2. Picks the most important task
3. Implements it
4. Runs validation (tests, types, lint, build)
5. Commits changes
6. Exits ‚Üí loop restarts with fresh context

The key insight: **fresh context every iteration** prevents hallucination accumulation and context poisoning.

## Features

- **Two-phase workflow**: Planning mode (gap analysis) ‚Üí Building mode (implementation)
- **Docker isolation**: Run Ralph in a container so it can't touch your system files
- **OAuth token handling**: Automatic token loading for headless mode
- **Iteration summaries**: See commits, files changed, and progress after each task
- **Stuck detection**: Auto-skips tasks after 3 failed attempts
- **Session reports**: Summary of what was accomplished when the loop ends
- **File logging**: `tail -f ralph.log` to watch progress

## Usage

In Claude Code, run:

```
/setup-ralph
```

Then follow the prompts to configure:
- Project directory
- Tech stack (determines validation commands)
- Backpressure level (tests only ‚Üí full validation)
- Docker mode (yes/no)

## Generated Files

```
your-project/
‚îú‚îÄ‚îÄ loop.sh              # Main loop script
‚îú‚îÄ‚îÄ loop-docker.sh       # Docker-wrapped loop (if selected)
‚îú‚îÄ‚îÄ Dockerfile           # Container definition (if selected)
‚îú‚îÄ‚îÄ PROMPT_plan.md       # Planning mode instructions
‚îú‚îÄ‚îÄ PROMPT_build.md      # Building mode instructions
‚îú‚îÄ‚îÄ AGENTS.md            # Operational learnings (you update this)
‚îú‚îÄ‚îÄ IMPLEMENTATION_PLAN.md  # Task list (generated by planning)
‚îú‚îÄ‚îÄ specs/               # Your requirement docs go here
‚îî‚îÄ‚îÄ src/                 # Code goes here
```

## Running the Loop

**Direct mode:**
```bash
./loop.sh plan          # Generate implementation plan
./loop.sh               # Build until complete
./loop.sh 20            # Build max 20 iterations
```

**Docker mode (isolated):**
```bash
./loop-docker.sh --build-image   # First time only
./loop-docker.sh plan            # Generate plan
./loop-docker.sh                 # Build in container
```

## Iteration Output

After each iteration, you'll see:

```
‚îÅ‚îÅ‚îÅ Iteration 5 Complete (2m 34s) ‚îÅ‚îÅ‚îÅ
‚úÖ Commit: abc1234 [city] Add procedural building generation
üìÅ Files: +2 new, ~3 modified
   üÜï src/CityGenerator.ts
   üÜï src/Building.ts
   ‚úèÔ∏è  src/Game.ts
   ‚úèÔ∏è  src/World.ts
üìä Progress: 5/22 tasks (23%)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

## Your Role

**Sit on the loop, not in it.**

You:
- Write specs in `specs/` (one file per topic)
- Watch for failure patterns
- Update `AGENTS.md` with learnings
- Ctrl+C to stop when needed

You don't:
- Jump in to fix code manually
- Interfere with the autonomous process

When Ralph struggles repeatedly, update the environment (specs, AGENTS.md, prompts) rather than fixing code directly.

## OAuth Setup (Required for Headless Mode)

```bash
# Generate token
claude setup-token

# Save it
echo "sk-ant-oat01-YOUR-TOKEN" > ~/.claude-oauth-token
chmod 600 ~/.claude-oauth-token
```

The loop scripts automatically load this token.

## Docker Mode

Docker mode runs Claude in an isolated container:
- ‚úÖ Can only access the project directory
- ‚úÖ Can't modify system files
- ‚úÖ Uses your Claude Max subscription via OAuth token
- ‚úÖ Non-root user (required for `--dangerously-skip-permissions`)

First time setup:
```bash
./loop-docker.sh --build-image
```

Then just run `./loop-docker.sh` - switches seamlessly between Docker and direct mode.

## Writing Good Specs

Each spec file should pass the **"one sentence without 'and'" test**:

- ‚úÖ `specs/authentication.md` - "User login with credentials"
- ‚úÖ `specs/session-management.md` - "Session lifecycle and validation"
- ‚ùå `specs/user-system.md` - "Auth AND profiles AND billing" (too broad)

Include:
- Clear requirements
- Examples where helpful
- Acceptance criteria
- NOT implementation details (that's Ralph's job)

## Credits

Based on [Geoffrey Huntley's Ralph Wiggum technique](https://ghuntley.com/ralph/).

## License

MIT
