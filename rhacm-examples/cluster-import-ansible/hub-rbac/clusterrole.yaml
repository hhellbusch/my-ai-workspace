---
# ClusterRole with minimal permissions for cluster import automation
# Follows principle of least privilege
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-importer
  labels:
    app: rhacm-automation
    purpose: cluster-import
rules:
  # Permission to create and manage namespaces for imported clusters
  - apiGroups: [""]
    resources: ["namespaces"]
    verbs: ["create", "get", "list", "watch"]
  
  # Permission to create and read secrets (for import manifests)
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list", "watch"]
    # Note: Limited to read-only for secrets
    # Import secrets are auto-generated by RHACM
  
  # Permission to create and manage ManagedCluster resources
  - apiGroups: ["cluster.open-cluster-management.io"]
    resources: ["managedclusters"]
    verbs: ["create", "get", "list", "watch", "update", "patch"]
  
  # Permission to read ManagedCluster status
  - apiGroups: ["cluster.open-cluster-management.io"]
    resources: ["managedclusters/status"]
    verbs: ["get", "list", "watch"]
  
  # Permission to create and manage KlusterletAddonConfig
  - apiGroups: ["agent.open-cluster-management.io"]
    resources: ["klusterletaddonconfigs"]
    verbs: ["create", "get", "list", "watch", "update", "patch"]
  
  # Permission to create and manage ManagedClusterSets (optional)
  # Uncomment if you want to auto-assign clusters to sets
  #- apiGroups: ["cluster.open-cluster-management.io"]
  #  resources: ["managedclustersets"]
  #  verbs: ["get", "list", "watch"]
  #
  #- apiGroups: ["cluster.open-cluster-management.io"]
  #  resources: ["managedclustersets/join"]
  #  verbs: ["create"]
  
  # Permission to create and manage ManagedClusterSetBindings (optional)
  #- apiGroups: ["cluster.open-cluster-management.io"]
  #  resources: ["managedclustersetbindings"]
  #  verbs: ["create", "get", "list", "watch"]
